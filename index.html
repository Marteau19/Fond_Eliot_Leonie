<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le Fond Dynastie Martel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: #0a0a0a;
            min-height: 100vh;
            padding: 20px;
            color: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .title-container {
            text-align: center;
            margin-bottom: 40px;
        }

        .subtitle {
            font-size: 1em;
            font-weight: 400;
            letter-spacing: 3px;
            text-transform: uppercase;
            color: #888;
            margin-bottom: 10px;
        }

        h1 {
            font-size: 3.5em;
            font-weight: 700;
            letter-spacing: 4px;
            text-transform: uppercase;
            line-height: 1.2;
            margin: 0;
        }

        .title-dynastie {
            color: #ffffff;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .title-martel {
            color: #ffffff;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .card {
            background: #1a1a1a;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 1px solid #2a2a2a;
        }

        .card h2 {
            color: #ffffff;
            margin-bottom: 25px;
            font-size: 1.4em;
            font-weight: 600;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            border-bottom: 2px solid #D4AF37;
            padding-bottom: 12px;
        }

        .fund-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .metric {
            text-align: center;
            padding: 20px;
            background: #0f0f0f;
            border-radius: 10px;
            border-left: 4px solid #D4AF37;
            border: 1px solid #2a2a2a;
        }

        .metric-label {
            font-size: 0.85em;
            color: #999;
            margin-bottom: 10px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .metric-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #D4AF37;
        }

        .investors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .investor-card {
            background: #1a1a1a;
            color: #f5f5f5;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            text-align: center;
            border: 2px solid #D4AF37;
            margin-bottom: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .investor-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.3);
        }

        .investor-photo {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            object-position: center 30%;
            margin: 0 auto 20px;
            border: 3px solid #D4AF37;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
            display: block;
        }

        .investor-name {
            font-size: 1.4em;
            font-weight: 600;
            margin-bottom: 25px;
            text-align: center;
            color: #ffffff;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .investor-value-display {
            margin-bottom: 30px;
        }

        .investor-value-amount {
            font-size: 3.5em;
            font-weight: bold;
            line-height: 1;
            color: #D4AF37;
            text-shadow: 0 0 20px rgba(212, 175, 55, 0.4);
        }

        .investor-details {
            background: rgba(212, 175, 55, 0.05);
            padding: 15px 20px;
            border-radius: 8px;
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 0.9em;
        }

        .detail-row:not(:last-child) {
            border-bottom: 1px solid rgba(212, 175, 55, 0.15);
        }

        .detail-label {
            font-weight: 400;
            color: #999;
        }

        .detail-value {
            font-weight: 600;
            color: #f5f5f5;
        }

        .return-positive {
            color: #52c41a;
        }

        .return-negative {
            color: #ff4d4f;
        }

        .return-neutral {
            color: #f5f5f5;
        }

        .companies-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .company-logo-wrapper {
            background: #ffffff;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            aspect-ratio: 1;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 2px solid #2a2a2a;
            position: relative;
            overflow: hidden;
        }

        .company-logo-wrapper:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.3);
            border-color: #D4AF37;
        }

        .company-logo-wrapper img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .company-percentage {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: #D4AF37;
            color: #0a0a0a;
            padding: 3px 8px;
            border-radius: 6px;
            font-size: 0.75em;
            font-weight: 600;
        }

        .update-info {
            text-align: center;
            color: #666;
            margin-top: 30px;
            font-size: 0.85em;
            opacity: 0.8;
            font-style: italic;
        }

        @media (max-width: 600px) {
            .companies-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            .subtitle {
                font-size: 0.8em;
            }

            h1 {
                font-size: 2em;
                letter-spacing: 2px;
            }

            .card {
                padding: 15px;
            }

            .investor-name {
                font-size: 1.2em;
            }

            .investor-value-amount {
                font-size: 2.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="title-container">
            <div class="subtitle">Le Fond de la</div>
            <h1>
                <span class="title-dynastie">Dynastie</span> <span class="title-martel">Martel</span>
            </h1>
        </div>

        <div class="investors-grid" id="investorsGrid">
            <!-- Investor cards will be dynamically generated -->
        </div>

        <div class="card">
            <h2>Informations du Fond</h2>
            <div class="fund-overview">
                <div class="metric">
                    <div class="metric-label">Valeur du Fond</div>
                    <div class="metric-value" id="fundValue">-</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Nombres d'actions</div>
                    <div class="metric-value" id="totalShares">-</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Valeur de l'action</div>
                    <div class="metric-value" id="sharePrice">-</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Année à date</div>
                    <div class="metric-value" id="perfYTD">-</div>
                </div>
                <div class="metric">
                    <div class="metric-label">1 an</div>
                    <div class="metric-value" id="perf1Year">-</div>
                </div>
                <div class="metric">
                    <div class="metric-label">2 ans</div>
                    <div class="metric-value" id="perf2Years">-</div>
                </div>
            </div>
        </div>

        <div class="card" id="companiesSection" style="display: none;">
            <h2>Nos Investissements</h2>
            <div class="companies-grid" id="companiesGrid">
                <!-- Company logos will be dynamically generated -->
            </div>
        </div>

        <div class="update-info">
            Dernière mise à jour: <span id="lastUpdate">-</span>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURATION - Replace with your Google Sheets URL
        // ============================================
        // To get this URL:
        // 1. Open your Google Sheet
        // 2. Click File > Share > Publish to web
        // 3. Choose the specific sheet tab and select "Comma-separated values (.csv)"
        // 4. Click Publish and copy the URL
        // 5. Paste it below

        const GOOGLE_SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRlKywnV2jHD3XcOY1Yc9S4MXXGlyv7tBUgZzRICljRdps7W2WNZ5wJTcJTSQp7tcWjohEK9Sfjb_LV/pub?output=csv';  // Leave empty to use data.json instead

        // ============================================

        // Format currency
        function formatCurrency(amount) {
            return '$' + parseFloat(amount).toFixed(2);
        }

        // Format percentage
        function formatPercentage(value) {
            return parseFloat(value).toFixed(2) + '%';
        }

        // Get return class based on value
        function getReturnClass(value) {
            const num = parseFloat(value);
            if (num > 0) return 'return-positive';
            if (num < 0) return 'return-negative';
            return 'return-neutral';
        }

        // Get investor photo based on name
        function getInvestorPhoto(name) {
            const nameLower = name.toLowerCase().trim();
            if (nameLower.includes('léonie') || nameLower.includes('leonie')) {
                return 'Leonie.png';
            } else if (nameLower.includes('éliot') || nameLower.includes('eliot')) {
                return 'Eliot.png';
            } else if (nameLower.includes('édouard') || nameLower.includes('edouard')) {
                return 'Edouard.png';
            }
            return ''; // No photo for unknown investors
        }

        // Parse CSV data from Google Sheets
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const result = {
                fund: {
                    value: 0,
                    totalShares: 0,
                    sharePrice: 0
                },
                investors: [],
                performance: {
                    ytd: 0,
                    oneYear: 0,
                    twoYears: 0
                },
                companies: []
            };

            // Helper to parse value and remove $ sign if present
            const parseValue = (val) => {
                if (!val) return 0;
                return parseFloat(val.replace(/[$,%]/g, '')) || 0;
            };

            // Track when we hit the "Title" row for companies
            let inCompaniesSection = false;

            // Parse each line dynamically
            lines.forEach((line, index) => {
                const values = line.split(',').map(v => v.trim());
                const columnA = values[0] || '';
                const columnB = values[1] || '';
                const columnC = values[2] || '';
                const columnD = values[3] || '';

                // Skip header rows (first 2 rows)
                if (index < 2) return;

                // Check if we're entering the companies section
                if (columnA.toLowerCase() === 'title' && columnB.toLowerCase() === 'logo') {
                    inCompaniesSection = true;
                    return;
                }

                // Parse company data if we're in the companies section
                if (inCompaniesSection && columnA && columnB && columnA.toLowerCase() !== 'title') {
                    result.companies.push({
                        name: columnA,
                        logoUrl: columnB,
                        percentage: parseValue(columnC)
                    });
                    return;
                }

                // Check for investor data (column D has a name)
                if (columnD && columnD.length > 0 && !columnA.toLowerCase().includes('rendement')) {
                    // This row has investor data
                    result.investors.push({
                        name: columnD,
                        investment: parseValue(values[4]),
                        shares: parseValue(values[5]),
                        currentValue: parseValue(values[6]),
                        return: parseValue(values[7])
                    });
                }

                // Extract fund information from column A/B
                if (columnA.toLowerCase().includes('valeur du fond')) {
                    result.fund.value = parseValue(columnB);
                } else if (columnA.toLowerCase().includes("nombres d'actions")) {
                    result.fund.totalShares = parseValue(columnB);
                } else if (columnA.toLowerCase().includes("valeurs de l'action")) {
                    result.fund.sharePrice = parseValue(columnB);
                }

                // Extract performance data
                if (columnA.toLowerCase().includes('année à date')) {
                    result.performance.ytd = parseValue(columnB);
                } else if (columnA === '1 an') {
                    result.performance.oneYear = parseValue(columnB);
                } else if (columnA === '2 ans') {
                    result.performance.twoYears = parseValue(columnB);
                }
            });

            return result;
        }

        // Load data from Google Sheets or JSON
        async function loadData() {
            try {
                let data;

                if (GOOGLE_SHEET_CSV_URL) {
                    // Fetch from Google Sheets
                    console.log('Fetching from Google Sheets:', GOOGLE_SHEET_CSV_URL);
                    const response = await fetch(GOOGLE_SHEET_CSV_URL);
                    const csvText = await response.text();
                    console.log('CSV received:', csvText.substring(0, 200) + '...');
                    data = parseCSV(csvText);
                    console.log('Parsed data:', data);
                } else {
                    // Fallback to local JSON
                    console.log('Using local data.json');
                    const response = await fetch('data.json');
                    data = await response.json();
                    console.log('JSON data loaded:', data);
                }

                // Validate data structure
                if (!data || !data.fund || !data.investors || !data.performance) {
                    throw new Error('Invalid data structure');
                }

                // Update fund overview
                document.getElementById('fundValue').textContent = formatCurrency(data.fund.value);
                document.getElementById('totalShares').textContent = data.fund.totalShares;
                document.getElementById('sharePrice').textContent = formatCurrency(data.fund.sharePrice);

                // Create investor cards
                const investorsGrid = document.getElementById('investorsGrid');
                investorsGrid.innerHTML = '';

                data.investors.forEach(investor => {
                    const card = document.createElement('div');
                    card.className = 'investor-card';

                    const returnClass = getReturnClass(investor.return);
                    const photoUrl = getInvestorPhoto(investor.name);
                    const photoHtml = photoUrl ? `<img src="${photoUrl}" alt="${investor.name}" class="investor-photo">` : '';

                    card.innerHTML = `
                        ${photoHtml}
                        <div class="investor-name">${investor.name}</div>
                        <div class="investor-value-display">
                            <div class="investor-value-amount">${formatCurrency(investor.currentValue)}</div>
                        </div>
                        <div class="investor-details">
                            <div class="detail-row">
                                <span class="detail-label">Investissement</span>
                                <span class="detail-value">${formatCurrency(investor.investment)}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Actions</span>
                                <span class="detail-value">${investor.shares}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Rendement</span>
                                <span class="detail-value ${returnClass}">${formatPercentage(investor.return)}</span>
                            </div>
                        </div>
                    `;

                    investorsGrid.appendChild(card);
                });

                // Update performance metrics (always gold)
                const perfYTD = document.getElementById('perfYTD');
                perfYTD.textContent = formatPercentage(data.performance.ytd);
                perfYTD.className = 'metric-value';

                const perf1Year = document.getElementById('perf1Year');
                perf1Year.textContent = formatPercentage(data.performance.oneYear);
                perf1Year.className = 'metric-value';

                const perf2Years = document.getElementById('perf2Years');
                perf2Years.textContent = formatPercentage(data.performance.twoYears);
                perf2Years.className = 'metric-value';

                // Update companies section
                if (data.companies && data.companies.length > 0) {
                    const companiesSection = document.getElementById('companiesSection');
                    const companiesGrid = document.getElementById('companiesGrid');

                    companiesGrid.innerHTML = '';

                    data.companies.forEach(company => {
                        const logoWrapper = document.createElement('div');
                        logoWrapper.className = 'company-logo-wrapper';

                        // Add cache-busting parameter to ensure fresh image loads
                        const cacheBuster = new Date().getTime();
                        const logoUrl = company.logoUrl.includes('?')
                            ? `${company.logoUrl}&_=${cacheBuster}`
                            : `${company.logoUrl}?_=${cacheBuster}`;

                        logoWrapper.innerHTML = `
                            <img src="${logoUrl}" alt="${company.name}" title="${company.name}">
                            <div class="company-percentage">${formatPercentage(company.percentage)}</div>
                        `;
                        companiesGrid.appendChild(logoWrapper);
                    });

                    companiesSection.style.display = 'block';
                } else {
                    document.getElementById('companiesSection').style.display = 'none';
                }

                // Update last modified date
                document.getElementById('lastUpdate').textContent = new Date().toLocaleDateString('fr-FR');

            } catch (error) {
                console.error('Error loading data:', error);
                console.error('Error details:', error.message, error.stack);
                alert('Erreur lors du chargement des données: ' + error.message + '\n\nVérifiez la console du navigateur (F12) pour plus de détails.');
            }
        }

        // Load data when page loads
        loadData();

        // Auto-refresh every 5 minutes to get latest data from Google Sheets
        setInterval(loadData, 300000);
    </script>
</body>
</html>
