<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suivi des Investissements - L√©onie & √âliot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .fund-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .metric {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .metric-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .metric-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
        }

        .investors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .investor-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .investor-name {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
            opacity: 0.95;
        }

        .investor-value-display {
            margin-bottom: 25px;
        }

        .investor-value-amount {
            font-size: 3.5em;
            font-weight: bold;
            line-height: 1;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .investor-details {
            background: rgba(255,255,255,0.1);
            padding: 12px 15px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            font-size: 0.85em;
        }

        .detail-row:not(:last-child) {
            border-bottom: 1px solid rgba(255,255,255,0.15);
        }

        .detail-label {
            font-weight: 500;
            opacity: 0.85;
        }

        .detail-value {
            font-weight: 600;
        }

        .return-positive {
            color: #4ade80;
        }

        .return-negative {
            color: #f87171;
        }

        .return-neutral {
            color: white;
        }

        .performance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .performance-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .performance-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .performance-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
        }

        .update-info {
            text-align: center;
            color: white;
            margin-top: 20px;
            font-size: 0.9em;
            opacity: 0.8;
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 1.8em;
            }

            .card {
                padding: 15px;
            }

            .investor-name {
                font-size: 1.2em;
            }

            .investor-value-amount {
                font-size: 2.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä Suivi des Investissements</h1>

        <div class="card">
            <h2>Investissements</h2>
            <div class="investors-grid" id="investorsGrid">
                <!-- Investor cards will be dynamically generated -->
            </div>
        </div>

        <div class="card">
            <h2>Rendement du Fond</h2>
            <div class="performance-grid">
                <div class="performance-item">
                    <div class="performance-label">Ann√©e √† date</div>
                    <div class="performance-value" id="perfYTD">-</div>
                </div>
                <div class="performance-item">
                    <div class="performance-label">1 an</div>
                    <div class="performance-value" id="perf1Year">-</div>
                </div>
                <div class="performance-item">
                    <div class="performance-label">2 ans</div>
                    <div class="performance-value" id="perf2Years">-</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>Informations du Fond</h2>
            <div class="fund-overview">
                <div class="metric">
                    <div class="metric-label">Valeur du Fond</div>
                    <div class="metric-value" id="fundValue">-</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Nombres d'actions</div>
                    <div class="metric-value" id="totalShares">-</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Valeur de l'action</div>
                    <div class="metric-value" id="sharePrice">-</div>
                </div>
            </div>
        </div>

        <div class="update-info">
            Derni√®re mise √† jour: <span id="lastUpdate">-</span>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURATION - Replace with your Google Sheets URL
        // ============================================
        // To get this URL:
        // 1. Open your Google Sheet
        // 2. Click File > Share > Publish to web
        // 3. Choose the specific sheet tab and select "Comma-separated values (.csv)"
        // 4. Click Publish and copy the URL
        // 5. Paste it below

        const GOOGLE_SHEET_CSV_URL = '';  // Leave empty to use data.json instead

        // ============================================

        // Format currency
        function formatCurrency(amount) {
            return '$' + parseFloat(amount).toFixed(2);
        }

        // Format percentage
        function formatPercentage(value) {
            return parseFloat(value).toFixed(2) + '%';
        }

        // Get return class based on value
        function getReturnClass(value) {
            const num = parseFloat(value);
            if (num > 0) return 'return-positive';
            if (num < 0) return 'return-negative';
            return 'return-neutral';
        }

        // Parse CSV data from Google Sheets
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const result = {
                fund: {
                    value: 0,
                    totalShares: 0,
                    sharePrice: 0
                },
                investors: [],
                performance: {
                    ytd: 0,
                    oneYear: 0,
                    twoYears: 0
                }
            };

            // Helper to parse value and remove $ sign if present
            const parseValue = (val) => {
                if (!val) return 0;
                return parseFloat(val.replace(/[$,%]/g, '')) || 0;
            };

            // Parse each line dynamically
            lines.forEach((line, index) => {
                const values = line.split(',').map(v => v.trim());
                const columnA = values[0] || '';
                const columnB = values[1] || '';
                const columnD = values[3] || '';

                // Skip header rows (first 2 rows)
                if (index < 2) return;

                // Check for investor data (column D has a name)
                if (columnD && columnD.length > 0 && !columnA.toLowerCase().includes('rendement')) {
                    // This row has investor data
                    result.investors.push({
                        name: columnD,
                        investment: parseValue(values[4]),
                        shares: parseValue(values[5]),
                        currentValue: parseValue(values[6]),
                        return: parseValue(values[7])
                    });
                }

                // Extract fund information from column A/B
                if (columnA.toLowerCase().includes('valeur du fond')) {
                    result.fund.value = parseValue(columnB);
                } else if (columnA.toLowerCase().includes("nombres d'actions")) {
                    result.fund.totalShares = parseValue(columnB);
                } else if (columnA.toLowerCase().includes("valeurs de l'action")) {
                    result.fund.sharePrice = parseValue(columnB);
                }

                // Extract performance data
                if (columnA.toLowerCase().includes('ann√©e √† date')) {
                    result.performance.ytd = parseValue(columnB);
                } else if (columnA === '1 an') {
                    result.performance.oneYear = parseValue(columnB);
                } else if (columnA === '2 ans') {
                    result.performance.twoYears = parseValue(columnB);
                }
            });

            return result;
        }

        // Load data from Google Sheets or JSON
        async function loadData() {
            try {
                let data;

                if (GOOGLE_SHEET_CSV_URL) {
                    // Fetch from Google Sheets
                    console.log('Fetching from Google Sheets:', GOOGLE_SHEET_CSV_URL);
                    const response = await fetch(GOOGLE_SHEET_CSV_URL);
                    const csvText = await response.text();
                    console.log('CSV received:', csvText.substring(0, 200) + '...');
                    data = parseCSV(csvText);
                    console.log('Parsed data:', data);
                } else {
                    // Fallback to local JSON
                    console.log('Using local data.json');
                    const response = await fetch('data.json');
                    data = await response.json();
                    console.log('JSON data loaded:', data);
                }

                // Validate data structure
                if (!data || !data.fund || !data.investors || !data.performance) {
                    throw new Error('Invalid data structure');
                }

                // Update fund overview
                document.getElementById('fundValue').textContent = formatCurrency(data.fund.value);
                document.getElementById('totalShares').textContent = data.fund.totalShares;
                document.getElementById('sharePrice').textContent = formatCurrency(data.fund.sharePrice);

                // Create investor cards
                const investorsGrid = document.getElementById('investorsGrid');
                investorsGrid.innerHTML = '';

                data.investors.forEach(investor => {
                    const card = document.createElement('div');
                    card.className = 'investor-card';

                    const returnClass = getReturnClass(investor.return);

                    card.innerHTML = `
                        <div class="investor-name">${investor.name}</div>
                        <div class="investor-value-display">
                            <div class="investor-value-amount">${formatCurrency(investor.currentValue)}</div>
                        </div>
                        <div class="investor-details">
                            <div class="detail-row">
                                <span class="detail-label">Investissement</span>
                                <span class="detail-value">${formatCurrency(investor.investment)}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Actions</span>
                                <span class="detail-value">${investor.shares}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Rendement</span>
                                <span class="detail-value ${returnClass}">${formatPercentage(investor.return)}</span>
                            </div>
                        </div>
                    `;

                    investorsGrid.appendChild(card);
                });

                // Update performance metrics
                const perfYTD = document.getElementById('perfYTD');
                perfYTD.textContent = formatPercentage(data.performance.ytd);
                perfYTD.className = 'performance-value ' + getReturnClass(data.performance.ytd);

                const perf1Year = document.getElementById('perf1Year');
                perf1Year.textContent = formatPercentage(data.performance.oneYear);
                perf1Year.className = 'performance-value ' + getReturnClass(data.performance.oneYear);

                const perf2Years = document.getElementById('perf2Years');
                perf2Years.textContent = formatPercentage(data.performance.twoYears);
                perf2Years.className = 'performance-value ' + getReturnClass(data.performance.twoYears);

                // Update last modified date
                document.getElementById('lastUpdate').textContent = new Date().toLocaleDateString('fr-FR');

            } catch (error) {
                console.error('Error loading data:', error);
                console.error('Error details:', error.message, error.stack);
                alert('Erreur lors du chargement des donn√©es: ' + error.message + '\n\nV√©rifiez la console du navigateur (F12) pour plus de d√©tails.');
            }
        }

        // Load data when page loads
        loadData();

        // Auto-refresh every 5 minutes to get latest data from Google Sheets
        setInterval(loadData, 300000);
    </script>
</body>
</html>
